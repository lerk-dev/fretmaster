<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="color-scheme" content="dark">
    <meta name="theme-color" content="#0f0f0f">
    <meta name="msapplication-navbutton-color" content="#0f0f0f">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title data-i18n-key="page_title">ğŸ¸ å‰ä»–ç»ƒä¹ å·¥å…· v3.7</title>

    <!-- å¼•å…¥å¤–éƒ¨CSSæ–‡ä»¶ -->
    <link rel="stylesheet" href="styles/main.css">

    <!-- è½»é‡ i18n å¼•å¯¼ï¼ˆä¼šæ‡’åŠ è½½ locales/*.jsonï¼‰ -->
    <script type="module">
    // ç®€åŒ–çš„ i18n å®¢æˆ·ç«¯ï¼šæŒ‰éœ€åŠ è½½ /locales/{locale}.json å¹¶æŠŠæ–‡æœ¬æ’å…¥åˆ°å…·æœ‰ data-i18n-key çš„å…ƒç´ 
    const DEFAULT_LOCALE = 'zh-CN';
    const LOCALE_STORAGE_KEY = 'fm_locale';

    async function loadLocale(locale) {
      try {
        const res = await fetch(`/locales/${locale}.json`, {cache: 'no-cache'});
        if (!res.ok) throw new Error('locale not found: ' + locale);
        return await res.json();
      } catch (err) {
        console.warn('Failed to load locale', locale, err);
        if (locale !== DEFAULT_LOCALE) {
          // å›é€€åˆ°é»˜è®¤
          return loadLocale(DEFAULT_LOCALE);
        }
        return {};
      }
    }

    function applyTranslations(translations) {
      document.querySelectorAll('[data-i18n-key]').forEach(el => {
        const key = el.dataset.i18nKey;
        if (!key) return;
        const txt = translations[key];
        if (typeof txt === 'string') {
          // å¦‚æœå…ƒç´ æœ‰ data-i18n-html="true" åˆ™ä½¿ç”¨ innerHTMLï¼ˆè°¨æ…ï¼‰
          if (el.dataset.i18nHtml === 'true') {
            el.innerHTML = txt;
          } else {
            el.textContent = txt;
          }
        }
      });
    }

    async function initI18n() {
      const saved = localStorage.getItem(LOCALE_STORAGE_KEY);
      let locale = saved || (navigator.language && navigator.language.startsWith('en') ? 'en' : 'zh-CN');
      // æš´éœ²åˆ‡æ¢å‡½æ•°
      window.FM = window.FM || {};
      window.FM.setLocale = async (newLocale) => {
        localStorage.setItem(LOCALE_STORAGE_KEY, newLocale);
        const t = await loadLocale(newLocale);
        applyTranslations(t);
      };
      // é¦–æ¬¡åŠ è½½
      const translations = await loadLocale(locale);
      applyTranslations(translations);
    }

    // åˆå§‹åŒ–ï¼ˆéé˜»å¡ï¼‰
    document.addEventListener('DOMContentLoaded', initI18n);
    </script>
</head>

<body>
  <header>
    <h1 data-i18n-key="app_title">ğŸ¸ å‰ä»–æŒ‡æ¿è§†è§‰åŒ–ç»ƒä¹ å·¥å…·</h1>
    <div>
      <label for="langSelect" data-i18n-key="interface_language">ç•Œé¢è¯­è¨€</label>
      <select id="langSelect" aria-label="è¯­è¨€é€‰æ‹©">
        <option value="zh-CN">ä¸­æ–‡</option>
        <option value="en">English</option>
      </select>
    </div>
  </header>

  <main>
    <button id="startBtn" data-i18n-key="btn_start">å¼€å§‹ç»ƒä¹ </button>
    <p id="status" data-i18n-key="status_ready">å‡†å¤‡å°±ç»ª</p>
  </main>

  <script>
    // è¯­è¨€é€‰æ‹© UI ç»‘å®šï¼ˆç®€å•ï¼‰
    const sel = document.getElementById('langSelect');
    const LOCALE_STORAGE_KEY = 'fm_locale';
    const saved = localStorage.getItem(LOCALE_STORAGE_KEY);
    if (saved) sel.value = saved;
    sel.addEventListener('change', async (e) => {
      const newLoc = e.target.value;
      if (window.FM && typeof window.FM.setLocale === 'function') {
        await window.FM.setLocale(newLoc);
      }
      localStorage.setItem(LOCALE_STORAGE_KEY, newLoc);
    });
  </script>
</body>

</html>